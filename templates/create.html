<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crea tu Chatbot - Plubot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Añadimos React Flow CSS -->
    <link rel="stylesheet" href="https://unpkg.com/reactflow@11.11.3/dist/style.css">
</head>
<body>
    <header>
        <nav>
            <a href="{{ url_for('index') }}">Inicio</a>
            <a href="{{ url_for('create_page') }}" class="active">Crear Chatbot</a>
            <a href="{{ url_for('logout') }}" id="logout">Cerrar Sesión</a>
        </nav>
    </header>
    <main>
        <div class="step-container" id="step1">
            <h1>Paso 1: Información Básica</h1>
            <form id="basic-info-form">
                <label for="name">Nombre del Chatbot:</label>
                <input type="text" id="name" name="name" required>
                <label for="tone">Tono:</label>
                <select id="tone" name="tone">
                    <option value="amigable">Amigable</option>
                    <option value="profesional">Profesional</option>
                    <option value="divertido">Divertido</option>
                    <option value="serio">Serio</option>
                </select>
                <label for="purpose">Propósito:</label>
                <input type="text" id="purpose" name="purpose" required>
                <label for="whatsapp_number">Número de WhatsApp (opcional):</label>
                <input type="text" id="whatsapp_number" name="whatsapp_number" placeholder="+1234567890">
                <label for="business_info">Información del Negocio (opcional):</label>
                <textarea id="business_info" name="business_info"></textarea>
                <button type="button" onclick="nextStep(1)">Siguiente</button>
            </form>
        </div>

        <div class="step-container" id="step2" style="display: none;">
            <h1>Paso 2: Selecciona una Plantilla (Opcional)</h1>
            <div id="templates-list"></div>
            <button onclick="skipTemplates()">Omitir y personalizar</button>
            <button onclick="nextStep(2)">Siguiente</button>
        </div>

        <div class="step-container" id="step3" style="display: none;">
            <h1>Paso 3: Personaliza tu Chatbot</h1>
            <label for="pdf_url">URL del PDF (opcional):</label>
            <input type="url" id="pdf_url" name="pdf_url">
            <label for="image_url">URL de la Imagen (opcional):</label>
            <input type="url" id="image_url" name="image_url">
            <label for="menu_json">Menú en JSON (opcional):</label>
            <textarea id="menu_json" name="menu_json" class="menu-json-input" placeholder='Ejemplo: {"Cafés": {"Latte": {"precio": 3.5, "descripcion": "Café con leche cremoso"}}}'></textarea>
            <h3>Flujos de Conversación</h3>
            <div id="flow-editor" class="react-flow__container"></div>
            <button type="button" onclick="nextStep(3)">Siguiente</button>
        </div>

        <div class="step-container" id="step4" style="display: none;">
            <h1>Paso 4: Revisa y Crea</h1>
            <div id="preview"></div>
            <button type="button" onclick="submitChatbot()">Crear Chatbot</button>
            <button type="button" onclick="prevStep(4)">Volver</button>
        </div>

        <div class="step-container" id="bot-list" style="margin-top: 40px;">
            <h1>Tus Chatbots</h1>
            <div id="chatbots-list"></div>
        </div>
    </main>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Añadimos React Flow -->
    <script src="https://unpkg.com/reactflow@11.11.3/dist/umd/reactflow.min.js"></script>
    <script src="{{ url_for('static', filename='js/create-react.js') }}" type="text/babel"></script>
    <script>
        function nextStep(step) {
            document.getElementById(`step${step}`).style.display = 'none';
            document.getElementById(`step${step + 1}`).style.display = 'block';
        }
        function prevStep(step) {
            document.getElementById(`step${step}`).style.display = 'none';
            document.getElementById(`step${step - 1}`).style.display = 'block';
        }
        function skipTemplates() {
            document.getElementById('step2').style.display = 'none';
            document.getElementById('step3').style.display = 'block';
        }
    </script>
</body>
</html>